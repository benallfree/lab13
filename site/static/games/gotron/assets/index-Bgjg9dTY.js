import{PartySocket as t}from"https://js13kgames.com/2025/online/partysocket.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const o of t)if("childList"===o.type)for(const t of o.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&n(t)}).observe(document,{childList:!0,subtree:!0})}function n(t){if(t.ep)return;t.ep=!0;const n=function(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?n.credentials="include":"anonymous"===t.crossOrigin?n.credentials="omit":n.credentials="same-origin",n}(t);fetch(t.href,n)}}(),window.PartySocket=t;const n=(t=0,n=0,o=0)=>({x:t,y:n,z:o});function o(t,n,o){const e=t.createShader(n);return e?(t.shaderSource(e,o),t.compileShader(e),t.getShaderParameter(e,t.COMPILE_STATUS)?e:(t.deleteShader(e),null)):null}function e(t,n){const o=new Float32Array(16);for(let e=0;e<4;e++)for(let r=0;r<4;r++)o[4*e+r]=t[4*e+0]*n[0+r]+t[4*e+1]*n[4+r]+t[4*e+2]*n[8+r]+t[4*e+3]*n[12+r];return o}function r(){return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function i(t){const n=Math.cos(t),o=Math.sin(t);return new Float32Array([n,0,o,0,0,1,0,0,-o,0,n,0,0,0,0,1])}function a(t){const n=Math.cos(t),o=Math.sin(t);return new Float32Array([1,0,0,0,0,n,-o,0,0,o,n,0,0,0,0,1])}function s(t){const n=Math.cos(t),o=Math.sin(t);return new Float32Array([n,-o,0,0,o,n,0,0,0,0,1,0,0,0,0,1])}const c=t=>JSON.parse(JSON.stringify(t)),l=(t,n)=>new Proxy(t,{get(t,o){const e=t[o];return e&&"object"==typeof e&&!Array.isArray(e)?l(e,n):e},set:(t,o,e)=>(t[o]=e,n(),!0)}),d=(t=0,n=0,o=0)=>({x:t,y:n,z:o}),u=(t,o)=>{const r={position:d(),rotation:n(),quality:1,groupPosition:void 0,groupRotation:void 0,...t};let u=!1;const f=l(r,()=>{u=!0}),g={state:f,recalculate:()=>{o.recalculate(f),u=!0},render:(t,n,r,l)=>{u&&g.recalculate();let d=c(f.position),p=c(f.rotation);if(f.group){const{position:t,rotation:n}=f.group,o={x:d.x-t.x,y:d.y-t.y,z:d.z-t.z},r=Math.cos(n.x),c=Math.sin(n.x),l=Math.cos(n.y),u=Math.sin(n.y),g=Math.cos(n.z),m=Math.sin(n.z);let y=o.x*g-o.y*m,h=o.x*m+o.y*g,v=o.z,x=y*u+v*l;const b=y*l-v*u,w=h*r-x*c,A=h*c+x*r;d.x=t.x+b,d.y=t.y+w,d.z=t.z+A;const M=a(p.x),_=i(p.y),F=e(s(p.z),e(_,M)),E=a(n.x),S=i(n.y),T=e(s(n.z),e(S,E)),L=e(T,F),P=L[0];L[1],L[2];const z=L[4],R=L[5],O=L[6],q=L[8],k=L[9],B=L[10];p.y=Math.asin(-q),Math.abs(q)<.999999?(p.x=Math.atan2(k,B),p.z=Math.atan2(z,P)):(p.x=Math.atan2(-O,R),p.z=0)}const m=(y=d.x,h=d.y,v=d.z-15,new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,y,h,v,1]));var y,h,v;const x=a(p.x),b=i(p.y),w=e(s(p.z),e(b,x)),A=e(w,m);o.render(t,n,A,l)}};return o.recalculate(f),g};function f(t,n){const{scene:o=window.scene}={},{gl:e}=o;if(!o)throw new Error("Scene is required");const r=e.createBuffer();return u({color:[1,1,1],vertices:[[0,0,0],[1,0,0],[0,1,0]],...t},{recalculate:t=>{const n=((t,n)=>{const o=new Float32Array(6*t.length);for(let e=0;e<t.length;e++){const r=6*e;o[r+0]=t[e][0],o[r+1]=t[e][1],o[r+2]=t[e][2],o[r+3]=n[0],o[r+4]=n[1],o[r+5]=n[2]}return o})(t.vertices,t.color);e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW)},render:(t,n,o,e)=>{if(!r)return;t.bindBuffer(t.ARRAY_BUFFER,r);const i=t.getAttribLocation(n,"a_position"),a=t.getAttribLocation(n,"a_color");t.enableVertexAttribArray(i),t.enableVertexAttribArray(a),t.vertexAttribPointer(i,3,t.FLOAT,!1,24,0),t.vertexAttribPointer(a,3,t.FLOAT,!1,24,12);const s=t.getUniformLocation(n,"u_modelViewMatrix");t.uniformMatrix4fv(s,!1,o),t.drawArrays(e?t.LINE_LOOP:t.TRIANGLES,0,3)}})}!function(){const t=function(){const{global:t=!0,width:n=800,height:e=600}={},i=document.createElement("canvas");i.width=n,i.height=e;const a=i.getContext("webgl"),s=function(t,n){const o=1/Math.tan(22.5*Math.PI/180);return new Float32Array([o/n,0,0,0,0,o,0,0,0,0,100.1/-99.9,-1,0,0,20/-99.9,0])}(0,i.width/i.height),c=[];let l=!1,d=1,u=0;const f=function(){const t=o(a,a.VERTEX_SHADER,"\n  attribute vec3 a_position;\n  attribute vec3 a_color;\n  \n  uniform mat4 u_modelViewMatrix;\n  uniform mat4 u_projectionMatrix;\n  \n  varying vec3 v_color;\n  \n  void main() {\n    gl_Position = u_projectionMatrix * u_modelViewMatrix * vec4(a_position, 1.0);\n    v_color = a_color;\n  }\n"),n=o(a,a.FRAGMENT_SHADER,"\n  precision mediump float;\n  \n  varying vec3 v_color;\n  \n  void main() {\n    gl_FragColor = vec4(v_color, 1.0);\n  }\n"),e=function(t,n,o){const e=t.createProgram();return e?(t.attachShader(e,n),t.attachShader(e,o),t.linkProgram(e),t.getProgramParameter(e,t.LINK_STATUS)?e:(t.deleteProgram(e),null)):null}(a,t,n);a.useProgram(e);const r=a.getUniformLocation(e,"u_projectionMatrix");return a.uniformMatrix4fv(r,!1,s),e}();a.enable(a.DEPTH_TEST),a.clearColor(.2,.3,.4,1);const g={canvas:i,gl:a,add:function(t){c.push(t)},render:function(t){a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);for(const n of c)n.render(a,f,r(),l)},renderHUD:function(){let t=document.getElementById("webgl-hud");t||(t=document.createElement("div"),t.id="webgl-hud",t.style.cssText="\n          position: fixed;\n          top: 10px;\n          left: 10px;\n          background: rgba(0, 0, 0, 0.8);\n          color: white;\n          font-family: monospace;\n          font-size: 12px;\n          padding: 10px;\n          border-radius: 5px;\n          z-index: 1000;\n          min-width: 200px;\n        ",document.body.appendChild(t));const n=c.length;t.innerHTML=`\n        <div style="margin-bottom: 10px; font-weight: bold; border-bottom: 1px solid #666; padding-bottom: 5px;">\n          WebGL Scene Controls\n        </div>\n        <div style="margin-bottom: 5px;">\n          <strong>Wireframe:</strong> ${l?"ON":"OFF"} <span style="color: #aaa;">(press .)</span>\n        </div>\n        <div style="margin-bottom: 5px;">\n          <strong>Global Quality:</strong> ${(100*d).toFixed(0)}% <span style="color: #aaa;">(press q)</span>\n        </div>\n        <div style="margin-bottom: 5px;">\n          <strong>LOD Distance:</strong> ${u} <span style="color: #aaa;">(press l)</span>\n        </div>\n        <div style="margin-bottom: 5px;">\n          <strong>Objects:</strong> ${n} total\n        </div>\n        <div style="margin-bottom: 10px; border-top: 1px solid #666; padding-top: 5px;">\n          <strong>Controls:</strong>\n        </div>\n        <div style="font-size: 11px; color: #ccc;">\n          <div>• <strong>.</strong> - Toggle wireframe</div>\n          <div>• <strong>q</strong> - Toggle quality (high/low)</div>\n          <div>• <strong>l</strong> - Toggle LOD (on/off)</div>\n        </div>\n      `},wireframe:function(t){return l=void 0!==t?t:!l,l},quality:function(t){if(void 0!==t){d=Math.max(0,Math.min(1,t));for(const t of c)t.state.quality=d}return d},lod:function(t){if(void 0!==t){u=t;for(const n of c){const o=Math.max(.1,1-t/50);n.state.quality=o}}return u}};return t&&(window.scene=g),g}();document.body.appendChild(t.canvas),document.addEventListener("keydown",n=>{if("."===n.key)t.wireframe();else if("q"===n.key){const n=t.quality()>.5?.3:.9;t.quality(n)}else if("l"===n.key){const n=t.lod()>10?0:25;t.lod(n)}});const n=f({color:[1,0,0],vertices:[[-.5,-.5,0],[.5,-.5,0],[0,.5,0]],position:d(-1,0,0)});t.add(n);const e=function(t){const{scene:n=window.scene}={};if(!n)throw new Error("Scene is required");const o=u({children:[],...t},{recalculate:t=>{for(const n of t.children)n.state.group={position:c(t.position),rotation:c(t.rotation)}},render:(t,n,e,r)=>{for(const i of o.state.children)i.render(t,n,e,r)}});return{...o,add:function(t){o.state.children.push(t),o.recalculate()},remove:function(t){const n=o.state.children.indexOf(t);n>-1&&(o.state.children.splice(n,1),o.recalculate())},getChildren:function(){return[...o.state.children]}}}({children:[f({color:[0,1,0],vertices:[[-.5,-.5,0],[.5,-.5,0],[0,.5,0]],position:d(.5,0,0)}),f({color:[1,0,0],vertices:[[-.5,-.5,0],[.5,-.5,0],[0,.5,0]],position:d(-.5,0,0)})],position:d(4,0,0)});t.add(e),requestAnimationFrame(function o(r){n.state.rotation.y=.001*r,n.state.rotation.x=.002*r,n.state.rotation.z=.0035*r,e.state.rotation.y=5e-4*r,e.state.rotation.x=5e-4*r,t.render(r),t.renderHUD(),requestAnimationFrame(o)})}();
